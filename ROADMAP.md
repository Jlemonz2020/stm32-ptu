# 🗺️ 项目路线图

## 📌 当前版本：v1.0

### 技术栈

**硬件平台**
- MCU: STM32F407VET6 (ARM Cortex-M4, 168MHz)
- 视觉: MaixCAM (240x240, UART)
- 电机: 张大头42步闭环步进电机 (16细分, 3200脉冲/圈)

**软件架构**
- RTOS: FreeRTOS
- 控制算法: PID (Kp=150, Ki=0, Kd=0)
- 通信: UART (115200bps)
- 开发环境: Keil MDK-ARM

**核心功能**
- 双轴独立PID控制 (50Hz)
- 实时串口调试系统
- 三级调试输出控制 (debug/log/cam)
- 智能锁定检测 (±8像素)
- 云台自检功能

---

## 🔍 v1.0 存在的问题

### 通信方面

#### 1. 无数据校验机制
**问题**:
- MaixCAM发送数据格式: "X,Y\n"，无校验和
- 串口干扰可能导致错误数据
- 无法检测数据传输错误

**影响**: 错误数据导致云台误动作

**改进方向**:
```c
// 当前: "113,114\n"
// 改进: "113,114,CRC\n" 或 "113,114*6B\n"
```

#### 2. 无超时保护
**问题**:
- 相机断开后系统不知道
- 长时间无数据时行为不明确
- 无自动重连机制

**影响**: 相机故障时系统无响应

**改进方向**:
```c
// 添加超时检测
#define CAMERA_TIMEOUT_MS  1000
if (no_data_time > CAMERA_TIMEOUT_MS) {
    // 停止电机，报警
}
```

#### 3. 电机无反馈
**问题**:
- 只发送命令，不接收反馈
- 不知道电机是否执行成功
- 无法检测失步或堵转

**影响**: 控制精度无法验证，故障无法发现

**改进方向**: 添加电机状态查询，获取实际位置反馈

#### 4. 缓冲区溢出风险
**问题**:
- 相机接收缓冲区仅32字节
- 高速数据时可能溢出
- 无溢出保护

**影响**: 数据丢失或系统崩溃

**改进方向**: 使用环形缓冲区或增大缓冲区

---

### 控制算法方面

#### 1. 纯P控制局限性
**问题**:
- 当前Ki=0, Kd=0，仅使用比例控制
- 存在稳态误差（3-5像素）
- 无法精确对准中心

**实测数据**:
```
目标中心: (120, 120)
实际锁定: (115, 118)
稳态误差: 5像素 (4.2%)
```

**影响**: 目标无法精确居中，需要±8像素死区才能锁定

**改进方向**:
- 添加积分项消除稳态误差: Ki = 0.3~0.5
- 添加微分项减少超调: Kd = 10~20

#### 2. 死区固定不灵活
**问题**:
- 死区固定为8像素
- 快速目标响应慢
- 静止目标可能抖动

**影响**: 无法平衡精度和稳定性

**改进方向**: 根据目标运动速度自适应调整死区

#### 3. 无目标预测
**问题**:
- 直接使用当前帧位置
- 跟踪运动目标时滞后
- 响应时间800-1200ms

**影响**: 跟踪运动目标效果差

**改进方向**: 实现简单线性预测或卡尔曼滤波

#### 4. PID与电机控制脱节
**问题**:
- PID输出直接乘以0.01转角度
- 未考虑电机响应特性
- 无速度前馈补偿

**影响**: 控制效果不够理想

**改进方向**: 根据电机特性优化PID输出映射

---

## 📊 性能现状

### 当前性能指标
```
控制周期: 20ms (目标) / 22-25ms (实际波动)
响应时间: 800-1200ms
定位精度: ±8像素 (3.3%)
稳态误差: 3-5像素
锁定成功率: ~85%
```

### 主要瓶颈
- 纯P控制导致稳态误差
- 无数据校验影响可靠性
- 无电机反馈影响精度
- 控制周期不够稳定

---

## 🎯 v1.1 改进计划

### 通信优化
- [ ] 添加数据校验（CRC8）
- [ ] 实现超时检测和保护
- [ ] 增加电机状态反馈
- [ ] 优化缓冲区管理

### 算法优化
- [ ] 添加积分项消除稳态误差
- [ ] 实现自适应死区
- [ ] 添加简单目标预测
- [ ] 优化PID参数自动调整

### 预期效果
```
控制周期: 20±2ms (稳定)
响应时间: 500-800ms
定位精度: ±5像素 (2.1%)
稳态误差: <2像素
锁定成功率: >95%
```

---

**更新时间**: V1.0    2026-02-25  
**维护者**: Jlemonz
